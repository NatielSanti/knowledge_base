[Заглавная](README.md)

# project15-11-2022

+ [Сервисы](project15-11-2022.md#Сервисы)
+ [Основные сценарии](project15-11-2022.md#Основные-сценарии)
+ [Integration Services Overview](project15-11-2022.md#Integration-Services-Overview)
+ [Инфраструктура](project15-11-2022.md#Инфраструктура)

[//]: # ([bash1]:img/lang/bashkort/bash1.png)

[к оглавлению](project15-11-2022.md#project15-11-2022)

## Основы

- Портфолио это набор программ, принадлежащих одному бренду.
- Портфолио бывает двух типов
  - стандартный. Включает абсолютно все программы
  - промо, специальный тип. Ограничен по инвентори типам.
- Тип инновации - основной параметр программы
- Поля при инициализации проекта приходят из SAP. Поля зависимы друг от друга
- Руководители программы
  - GBP - создатель программы
  - NPL PL - руководитель программы. New Product Launcher
  - GBP - расчет финансов и ожидаемой прибыли
- FPT система, занимающаяся расчетом продаж. На первом этапе
- SAP система, занимается расчетом на поздних этапах. Данные приходят на регулярной основе.
- Промоушен программа позволяет внести данные по sales вручную
- Ветка Дев-Куа-Уат содержат мажорный релиз. Ветка саппорт минорный релиз
  
### 0 SG  Strategic planning 
- 4 разных человека должно подтвердить программу и обязательные поля.
- Заполнить продукты программы

### 1 SG  Concept
- Концепт бриф - документ презентация. Представляется вице-президенту бренда, 
потом подписывается президентом и передаётся в исполнение. Ориентирован на производство нового.
- Для Commercial Innovation  не нужен Концепт бриф. Для него создаётся Commercial Innovation бриф.
Ориентирован на коммерческое решение. Для 

### 2 SG  Program Brief
- Планировщик вместе с маркетологом и продакт девелопментом и с пакедж девелопментом. 
Создают документ и полное его описание.
- Тут создаются SKU (Storage Keep Unit)
- Для Commercial Innovation 2 SG нет

## Сервисы

###  master-data

- Справочник с различной фильтрацией. Почти все выпадающие меню обращаются сюда.
- Состав выпадающего меню зависит от пользователя\брэнда.
Хотя часть справочников берутся из внешней системы.

### edl-integration

Работает всегда и отслеживает все изменения программы и не только. Звучит как аспект, 
который отслеживает состояние системы со стороны бизнеса (Создание\модификация программ 
и продуктов и пр.). Отправляет в третью систему.

### gcs-integration

Global Coding System. Отправляет и получает данные. Product Workspace
- В определённом жизненном цикле есть возможность отправить `SKU` в `gcs` у некоторых ролей
- Из сторонней системы заполняет поля `Finish Good Code` и `UPC` в `SKU`

### plc-integration

`edl-integration`  но не всегда отправляет. Разделение по командам, 
но по сути делают нечто похожее.

### rds-integration

триггер - кнопка в `R&D Workspace` и данные улетают в RDS систему. 
Плюс часть данных может прилететь от RDS

### sap-bw-integration

Это две джобы, которые запускаются ежедневно и импортируют `sales`.
- Данные из `sap-bw` можно увидеть на Workspace в SKU,
а также в Portfolio Management в секцию `GBP`. 
- Подключается в удалённую директорию, где читает файлы

### tlm-integration

Имеет триггер на фронтэнде и изменение состояния программы. 
Так же кнопкой отправляется из какого-то SKU. Product Workspace.

### sbs-integration

VisionOne. Подключается к базе

[к оглавлению](project15-11-2022.md#project15-11-2022)

## Основные сценарии

- У модулей есть клиенты.
Н-р `Program Search Client` это всё ретрофитовские имплементации.
В запрос приходят разные критерии фильтра.
- Используются разные `PreAuthorize` для секьюрити
- Сущности `Program`:
  - Concept Brief - получение, эвенты, экшены, сабмиты. Все табы связаны
  - Program Technical Brief. Все табы имеют свой ЖЦ. 
  Потому что заполняется людьми с разными ролями
  - Role(в секции Team), Season, Milestone(Stage Gate) etc.
- `Product` бывают двух типов. На деле это одно и тоже, 
но просто в разные моменты жизненного цикла продукта. Чтобы перейти из первого `Stage Gate`
Нужно создать и заполнить поля воркспейса
  - из портфолио. В нём 4 разных формы для заполнения - `Product marketing`, 
  `GBP` (ForecastRetrofitClient), `Product development` (ProductDevelopmentRetrofitClient), 
  `NPL PM` (NplPmRetrofitClient). BIT
  - из воркспейса `ProductWorkspaceData`. Есть поле `SKU`. Изначально воркспейс 
  заполняется данными из портфолио. BIP (Business Innovation Portal)
    - стандартный. Заполнено поле `productList`
    - enhanced (продукты группируются по группам) заполнено поле `groupList`. Есть WIP
- Сущности `Product`
- `StageGateAchievementChecker.canBeAchieved()` проверки может ли быть 
достигнуть какой-то `Stage gate`
- Если при создании нового продукта заполнить поля особым образом, 
то не все поля можно будет заполнить от руки, а будет требовать данных с интеграции
- `dz_gpm` юзер со всеми правами

[к оглавлению](project15-11-2022.md#project15-11-2022)

## Integration Services Overview

- `EVENT_TYPES` все возможные типы событий в системе, все топики  Azure Service Bus
- Список того какой сервис какие сообщения прослушивает лежит в `servicebus` модуле
- Есть возможность использовать ASB при работе локально, для этого есть VPN топики, 
которые работают из локальной машины. `README.md` в `sbs-integration` инструкция 
по созданию личных топиков. Потом в `application-asb.yml` правим строку `environment` 
и вставляем туда свой топик, а так же при запуске указывает профиль `asb`
- В  Azure есть страничка Service Bus Explorer - отсюда можно кидать сообщения в очереди.
- Сообщения сжимаются при помощи `gzip`
- Есть опция посмотреть сообщения на проде, но через `RDP` и специальной приложухой
- `gcs-integration`, `rds-integration` общается с внешней системой через `Kafka`
- Sales приходят:
  - actual, forecast, shipment из `SAP BW` отображается как `SAP BW sync`
  - proposed из `SBS` отображается как `FPT sync`
- У нас три квастера - ПРОД, ДЕВ, НОНПРОД(QA, Support, UAT, Hotfix). 
К кластерам подключать по ссылке в конфлю - HOW TOs.
  
[к оглавлению](project15-11-2022.md#project15-11-2022)

## Инфраструктура

- `ProgramScopeAwareRepository` - на ряду с обычным `ProgramRepository` необходим для 
фильтрации по бренду. Каждая программа доступна в рамках какого-то бренда. Реализовано в 
`HibernateFilterAspect`. Аспект, который позволяет не писать каждый раз `WHERE` блок.
- Как найти креды к сторонним источникам.  
Кластер > Insight > Containers > filter (н-р sbs) > More (Список всех env переменных) > 
Построковый поиск ("datasource")
- Spring Boot Actuator - не во всех сервисах все его эндпоинты подключены. Мониторинг.
  > kuberctl get pods -n dev -o wide

Берём IP нужного сервиса и обращаемся к нему напрямую по эндпоинтам актуатора.
- `Insight Azure` - встроенные метрики.
- Так же есть самописные метрики на `Micrometer` н-р `SourceSalesUpdateHandler`. 
По аннотации `@Timed(class.method)` по классу и методу перехватывает события и пишет метрики. 
Включается в Azure через файл `applicationinsights.json` ,а так же создание бина `TimedAspect`
- `applicationinsights-agent-3.0.0.jar` подключается в докерфайле, занимается отправкой логов 
в `Azure Portal`.
- `Redis Cache` чаще всего используется для хранения справочной информации 
в рамках `master-data` и `graphql`.

[к оглавлению](project15-11-2022.md#project15-11-2022)

[Заглавная](README.md)
