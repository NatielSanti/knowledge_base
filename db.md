[Заглавная](README.md)

# DB

+ [Языки структуры БД](db.md#Языки-структуры-БД)
+ [Типы БД](db.md#Типы-БД)
+ [CAP theory](db.md#CAP-theory)
+ [Пессимистическая и оптимистическая блокировка](db.md#Пессимистическая-и-оптимистическая-блокировка)
+ [Типы индексов](db.md#Indexes)

[sql-type]:img/db/sql_type.PNG
[sql-nosql]:img/db/sql-nosql.PNG
[cap]:img/db/cap.PNG

## Типы БД

![icon][sql-nosql]

[к оглавлению](#DB)

## Языки структуры БД

![icon][sql-type]

[к оглавлению](#DB)

## CAP theory

- согласованность данных (англ. consistency) — во всех вычислительных узлах в один момент времени данные 
не противоречат друг другу;
- доступность (англ. availability) — любой запрос к распределённой системе завершается корректным откликом, 
однако без гарантии, что ответы всех узлов системы совпадают;
- устойчивость к разделению (англ. partition tolerance) — расщепление распределённой системы на 
несколько изолированных секций не приводит к некорректности отклика от каждой из секций.

Базы данных могут выполнять только 2 из трёх условий:
- *CA* (`Availability + Consistency – Parition tolerance`), 
когда данные во всех узлах кластера согласованы и доступны, но не устойчивы к разделению.
Это означает, что реплики одной и той же информации, распределенные по разным серверам друг другу, 
не противоречат друг другу и любой запрос к распределённой системе завершается корректным откликом. 
Такие системы возможны при поддержке ACID-требований к транзакциям 
(`Атомарность, Согласованность, Изоляция, Долговечность`) и абсолютной надежности сети. 
На практике таких решений на основе кластерных систем управления базами данных почти не существует. 
Классическим примером CA-системы называют распределённую службу каталогов LDAP, 
а также реляционные базы данных (`PostgreSQL, MySQL, MariaDB, MS SQL Server`).
- *CP-система* (`Consistency + Partition tolerance – Availability`) в каждый момент обеспечивает 
целостность данных и способна работать в условиях распада в ущерб доступности, не выдавая отклик на запрос. 
Устойчивость к разделению требует дублирования изменений во всех узлах системы, 
что реализуется с помощью распределённых пессимистических блокировок для сохранения целостности. 
По сути, CP – это система с несколькими синхронно обновляемыми мастер-базами. 
Она всегда корректна, отрабатывая транзакцию, только в том случае, 
если изменения удалось распространить по всем серверам. 
Она продолжает корректно читать данные даже при отказе одного из узлов кластера. 
Но в этом случае запись будет обрываться или сильно задерживаться, 
пока система не убедится в своей целостности и согласованности (консистентности). 
Из NoSQL-СУБД к CP-системам принято относить 
`Apache HBase, MongoDB, Redis, MemcasheDB, Berkley DB, HyperTable и Google Big Table`.
- *AP-система* (`Availability + Partition tolerance – Consistency`) не гарантирует целостность данных, 
обеспечивая их доступность и устойчивость к разделению, например, как в распределённых веб-кэшах и DNS. 
Считается, что большинство NoSQL-СУБД относятся к этому классу систем, 
обеспечивая лишь некоторой уровень согласованности данных в конечном счете (`eventually consistent`). 
Таким образом, AP-система может быть представлена кластером из нескольких узлов, 
каждый из которых может принимать данные, но не обязуется в тот же момент распространять их на другие сервера. 
Такая система отлично справляется с отказами нескольких узлов, но, когда они снова начинают работать, 
возможна выдача пользователям старых данных. К AP-системам относят `CoucheDB, Cassandra, Riak, Amazon DynamoDB`.

![icon][cap]

[к оглавлению](#DB)

## Пессимистическая и оптимистическая блокировка

### Пессимистическое управление параллелизмом

Система блокировок не допускает, чтобы изменение данных одними пользователями влияло на других пользователей.
После того как действие пользователя приводит к блокировке, до тех пор пока инициатор ее не снимет, 
другие пользователи не могут выполнять действия, которые могут вызвать конфликт с блокировкой. 
Это называется пессимистическим управлением, поскольку в основном применяется в средах с 
большим количеством состязаний данных, где затраты на защиту данных с помощью блокировок меньше затрат 
на откат транзакций в случае конфликтов параллелизма.

### Оптимистическое управление параллелизмом

При оптимистическом управлении параллелизмом пользователи не блокируют данные на период чтения. 
Когда пользователь обновляет данные, система проверяет, вносил ли другой пользователь в них изменение 
после считывания. Если другой пользователь изменял данные, возникает ошибка. Как правило, 
при получении сообщения об ошибке пользователь откатывает транзакцию и начинает ее заново. 
Это называется оптимистическим управлением, поскольку в основном применяется в средах с 
небольшим количеством состязаний данных, где затраты на периодический откат транзакции меньше 
затрат на блокировку данных при считывании.

[к оглавлению](#DB)

## Indexes

#### Хеш таблицы
Hash-индексы были предложены Артуром Фуллером, и предполагают хранение не самих значений, 
а их хэшей, благодаря чему уменьшается размер(а, соответственно, и увеличивается скорость их обработки) 
индексов из больших полей. Таким образом, при запросах с использованием HASH-индексов, 
сравниваться будут не искомое со значения поля, а хэш от искомого значения с хэшами полей.
Из-за нелинейнойсти хэш-функций данный индекс нельзя сортировать по значению, 
что приводит к невозможности использования в сравнениях больше/меньше и «is null». 
Кроме того, так как хэши не уникальны, то для совпадающих хэшей применяются методы разрешения коллизий.

#### B-Tree

Семейство B-Tree индексов — это наиболее часто используемый тип индексов, 
организованных как сбалансированное дерево, упорядоченных ключей. 
Они поддерживаются практически всеми СУБД как реляционными, так нереляционными, 
и практически для всех типов данных.

Так как большинство, наверное, их хорошо знает(или могут прочесть о них например, здесь), 
то единственное, что, пожалуй, следует здесь отметить, это то, 
что данный тип индекса оптимален для множества с хорошим распределением значений и 
высокой мощностью(cardinality-количество уникальных значений).

#### Bitmap

Bitmap index – метод битовых индексов заключается в создании отдельных битовых карт 
(последовательность 0 и 1) для каждого возможного значения столбца, 
где каждому биту соответствует строка с индексируемым значением, а его значение равное 1 означает, 
что запись, соответствующая позиции бита содержит индексируемое значение для данного столбца или свойства.

[к оглавлению](#DB)

[Заглавная](README.md)